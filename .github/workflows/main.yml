name: Get database

on:
  push:
  workflow_dispatch:

jobs:
  build:
    if: "!contains(github.event.head_commit.message, '[ci skip]')"
    runs-on: windows-latest

    strategy:
      matrix:
        ida_version: [ 7.6, 7.5, 7.2 ]

    steps:
      - uses: actions/checkout@v2

      - name: Get processor model
        run: Get-WmiObject win32_Processor
        shell: powershell

      - name: Downloading IDA Pro
        uses: i3h/download-release-asset@v1
        with:
          owner: bedrock-server-mods
          repo: ida-pro-images
          tag: ${{ matrix.ida_version }}
          file: ida.zip
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

      - name: Installing IDA Pro ${{ matrix.ida_version }}
        run: |
          mv ida.zip installer/${{ matrix.ida_version }}
          cd installer/${{ matrix.ida_version }}
          $IDA_DIR = .\installer.ps1 | Select-Object -Last 1
          cp ../../database.idc "$IDA_DIR\idc\analysis.idc"
